<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
		<style>
			body {
				margin: 0;
			}

			canvas {
				display: block;
			}
		</style>
	</head>
	<body>
		<script type="module">
			import * as THREE from "three"
			import { VRButton } from "three/examples/jsm/webxr/VRButton.js"
			import { LookingGlassWebXRPolyfill } from "../dist/bundle/webxr.js"

			LookingGlassWebXRPolyfill.init({
				tileHeight: 512,
				numViews: 45,
				targetY: 1,
				targetZ: 0,
				targetDiam: 3,
				fovy: (14 * Math.PI) / 180,
			})

			const scene = new THREE.Scene()

			const logoTexture = new THREE.TextureLoader().load( "/public/RH-logo-color.png" );
			const logo = new THREE.Mesh(new THREE.PlaneGeometry(1, 1), new THREE.MeshStandardMaterial({ map: logoTexture, transparent: true }))
			logo.position.set(0, 1.3, 0)
			scene.add(logo)

			const geometry = new THREE.TorusKnotGeometry( 5, 1, 64, 4 ); 
			const wireframeGeometry = new THREE.WireframeGeometry( geometry );
			const line = new THREE.LineSegments( wireframeGeometry );
			// line.material.color = 0x493b8a;
			line.material.depthTest = false;
			// line.material.opacity = 0.25;
			line.material.transparent = true;
			console.log('material:', line);
			line.position.set(-5, 5, -5);
			scene.add( line );

			// const material = new THREE.MeshStandardMaterial( { color: 0xef2e8a } ); 
			// const torusKnot = new THREE.Mesh( geometry, material ); 
			
			// scene.add( torusKnot );

			scene.add(new THREE.GridHelper(10, 10, 0xb69d26, 0xb69d26))

			scene.add(new THREE.AmbientLight(0xaaaaaa))
			const directionalLight = new THREE.DirectionalLight(0xffffff)
			directionalLight.position.set(3, 3, -3)
			scene.add(directionalLight)

			const renderer = new THREE.WebGLRenderer({ antialias: true })
			document.body.append(renderer.domElement)
			console.log("I'm enabling XR")

			setTimeout(function () {
				renderer.xr.enabled = true
				document.body.append(VRButton.createButton(renderer))
			}, 2000)

			const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight)
			camera.position.set(0, 1.3, 3)

			renderer.setAnimationLoop(() => {
				// logo.lookAt(camera.position)
				renderer.render(scene, camera)
			})

			function resize() {
				renderer.setSize(innerWidth, innerHeight)
				camera.aspect = innerWidth / innerHeight
				camera.updateProjectionMatrix()
			}
			resize()
			window.addEventListener("resize", resize)
		</script>
	</body>
</html>
